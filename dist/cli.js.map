{
  "version": 3,
  "sources": ["../src/common.ts", "../src/base/constants.ts", "../src/base/env.ts", "../src/base/parser.ts", "../src/base/logging.ts", "../src/base/noerr.ts", "../src/base/process.ts", "../src/pup.ts", "../src/base/abort.ts", "../src/base/electron.ts", "../src/base/ffmpeg.ts", "../src/base/encoder.ts", "../src/base/limiter.ts", "../src/base/stream.ts", "../src/cli.ts"],
  "sourcesContent": ["// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/09.\n\nimport { program } from \"commander\";\nimport { pupUseInnerProxy } from \"./base/constants\";\nimport { logger } from \"./base/logging\";\nimport { noerr } from \"./base/noerr\";\nimport { parseNumber } from \"./base/parser\";\nimport { pargs } from \"./base/process\";\nimport type { RecordOptions } from \"./base/record\";\n\nexport const DEFAULT_WIDTH = 1920;\nexport const DEFAULT_HEIGHT = 1080;\nexport const DEFAULT_FPS = 30;\nexport const DEFAULT_DURATION = 5;\nexport const DEFAULT_OUT_DIR = \"out\";\n\nexport type CLICallback = (\n  source: string,\n  options: RecordOptions & Record<string, unknown>,\n) => Promise<unknown>;\n\nexport function makeCLI(name: string, callback: CLICallback) {\n  program\n    .name(name)\n    .argument(\"<source>\", \"URL \u6216 HTML data\")\n    .option(\"-w, --width <number>\", \"\u89C6\u9891\u5BBD\u5EA6\", `${DEFAULT_WIDTH}`)\n    .option(\"-h, --height <number>\", \"\u89C6\u9891\u9AD8\u5EA6\", `${DEFAULT_HEIGHT}`)\n    .option(\"-f, --fps <number>\", \"\u5E27\u7387\", `${DEFAULT_FPS}`)\n    .option(\"-t, --duration <number>\", \"\u5F55\u5236\u65F6\u957F\uFF08\u79D2\uFF09\", `${DEFAULT_DURATION}`)\n    .option(\"-o, --out-dir <path>\", \"\u8F93\u51FA\u76EE\u5F55\", `${DEFAULT_OUT_DIR}`)\n    .option(\"-a, --with-alpha-channel\", \"\u8F93\u51FA\u5305\u542B alpha \u901A\u9053\u7684\u89C6\u9891\", false)\n    .option(\n      \"--use-inner-proxy\",\n      \"\u4F7F\u7528 B \u7AD9\u5185\u7F51\u4EE3\u7406\u52A0\u901F\u8D44\u6E90\u8BBF\u95EE\",\n      pupUseInnerProxy,\n    )\n    .action(async (source: string, opts) => {\n      try {\n        await callback(source, {\n          width: noerr(parseNumber, DEFAULT_WIDTH)(opts.width),\n          height: noerr(parseNumber, DEFAULT_HEIGHT)(opts.height),\n          fps: noerr(parseNumber, DEFAULT_FPS)(opts.fps),\n          duration: noerr(parseNumber, DEFAULT_DURATION)(opts.duration),\n          outDir: opts.outDir ?? DEFAULT_OUT_DIR,\n          withAlphaChannel: opts.withAlphaChannel ?? false,\n          useInnerProxy: opts.useInnerProxy ?? pupUseInnerProxy,\n        });\n      } catch (e) {\n        logger.fatal(e);\n      }\n    });\n  program.parse(pargs());\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/09.\n\nimport { existsSync } from \"fs\";\nimport { resolve } from \"path\";\nimport { penv } from \"./env\";\nimport { parseNumber } from \"./parser\";\n\nconst pupAppSearchPaths = [\n  resolve(__dirname, \"cjs/app.cjs\"), // process from dist\n  resolve(__dirname, \"app.cjs\"), // process from dist/cjs\n  resolve(__dirname, \"../../cjs/app.cjs\"), // process from src\n];\nexport const pupAppPath = pupAppSearchPaths.find(existsSync)!;\n\nconst env = process.env;\nexport const pupLogLevel = penv(\"PUP_LOG_LEVEL\", parseNumber, 2);\nexport const pupUseInnerProxy = env[\"PUP_USE_INNER_PROXY\"] === \"1\";\nexport const pupFFmpegPath = env[\"FFMPEG_BIN\"] ?? `ffmpeg`;\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/25.\n\nexport type EnvParser<T> = (value: unknown) => T;\n\nexport function penv<T>(name: string, parser: EnvParser<T>, defaultValue: T): T;\nexport function penv<T>(\n  name: string,\n  parser: EnvParser<T>,\n  defaultValue?: T,\n): T | undefined;\nexport function penv<T>(\n  name: string,\n  parser: EnvParser<T>,\n  defaultValue?: T,\n): T | undefined {\n  try {\n    return parser(process.env[name]);\n  } catch {\n    return defaultValue;\n  }\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/01/30.\n\nexport function parseNumber(value: unknown): number {\n  if (typeof value === \"number\") {\n    return value;\n  }\n  const num = Number(value);\n  if (Number.isNaN(num)) {\n    throw new Error(`Value ${value} is not a valid number`);\n  }\n  return num;\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/06.\n\nimport { ChildProcess, type Serializable } from \"child_process\";\nimport { pupLogLevel } from \"./constants\";\n\nexport interface LoggerLike {\n  debug?(this: void, ...messages: unknown[]): void;\n\n  info?(this: void, ...messages: unknown[]): void;\n\n  warn?(this: void, ...messages: unknown[]): void;\n\n  error?(this: void, ...messages: unknown[]): void;\n}\n\nconst DEBUG = \"<pup@debug>\";\nconst INFO = \"<pup@info>\";\nconst WARN = \"<pup@warn>\";\nconst ERROR = \"<pup@error>\";\nconst FATAL = \"<pup@fatal>\";\n\nclass Logger implements LoggerLike {\n  private _impl?: LoggerLike;\n\n  get impl(): LoggerLike | undefined {\n    return this._impl;\n  }\n\n  set impl(value: LoggerLike) {\n    const debug = value.debug ?? console.debug;\n    const info = value.info ?? console.info;\n    const warn = value.warn ?? console.warn;\n    const error = value.error ?? console.error;\n    this._impl = {\n      debug: pupLogLevel >= 3 ? debug : undefined,\n      info: pupLogLevel >= 2 ? info : undefined,\n      warn: pupLogLevel >= 1 ? warn : undefined,\n      error: pupLogLevel >= 0 ? error : undefined,\n    };\n  }\n\n  constructor() {\n    this.impl = console;\n  }\n\n  debug(...messages: unknown[]): void {\n    this.impl?.debug?.(DEBUG, ...messages);\n  }\n\n  info(...messages: unknown[]): void {\n    this.impl?.info?.(INFO, ...messages);\n  }\n\n  warn(...messages: unknown[]): void {\n    this.impl?.warn?.(WARN, ...messages);\n  }\n\n  error(...messages: unknown[]): void {\n    this.impl?.error?.(ERROR, ...messages);\n  }\n\n  fatal(...messages: unknown[]): never {\n    this.impl?.error?.(FATAL, ...messages);\n    process.exit(1);\n  }\n\n  private dispatch(message: string) {\n    if (message.startsWith(DEBUG)) {\n      this.debug(message.slice(DEBUG.length + 1));\n    } else if (message.startsWith(INFO)) {\n      this.info(message.slice(INFO.length + 1));\n    } else if (message.startsWith(WARN)) {\n      this.warn(message.slice(WARN.length + 1));\n    } else if (message.startsWith(ERROR)) {\n      this.error(message.slice(ERROR.length + 1));\n    } else {\n      this.info(message);\n    }\n  }\n\n  attach(proc: ChildProcess, name: string) {\n    return new Promise<void>((resolve, reject) => {\n      this.debug(`${name}.attach`);\n      let fatal: string = \"\";\n      const dispatch = (data: Buffer | Serializable) => {\n        const message = data.toString();\n        if (message.startsWith(FATAL)) {\n          fatal += message.slice(FATAL.length + 1);\n        } else {\n          this.dispatch(message);\n        }\n      };\n      proc.stderr?.on(\"data\", dispatch);\n      proc.stdout?.on(\"data\", dispatch);\n      proc\n        .on(\"message\", dispatch)\n        .on(\"error\", (err) => {\n          fatal += err.message;\n          proc.kill();\n        })\n        .once(\"close\", (code, signal) => {\n          if (code || signal || fatal) {\n            fatal ||= `command failed: ${proc.spawnargs.join(\" \")}`;\n            this.error(`${name}.close`, { code, signal, fatal });\n            reject(new Error(fatal));\n          } else {\n            this.debug(`${name}.close`);\n            resolve();\n          }\n        })\n        .on(\"unhandledRejection\", (reason) => {\n          this.error(`${name}.unhandled`, reason);\n        })\n        .on(\"uncaughtExceptionMonitor\", (err) => {\n          this.error(`${name}.unhandled`, err);\n        });\n    });\n  }\n}\n\nconst logger = new Logger();\n\nexport { logger };\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/24.\n\nexport function noerr<Fn extends (...args: any[]) => any, D>(\n  fn: Fn,\n  defaultValue: D,\n): (...args: Parameters<Fn>) => ReturnType<Fn> | D {\n  return (...args) => {\n    try {\n      const ret = fn(...args);\n      if (ret instanceof Promise) {\n        return ret.catch(() => defaultValue);\n      }\n      return ret;\n    } catch {\n      return defaultValue;\n    }\n  };\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/01/30.\n\nimport { spawn, type ChildProcess, type SpawnOptions } from \"child_process\";\nimport { logger } from \"./logging\";\n\nexport const PUP_ARGS_ENV_KEY = \"__PUP_ARGS__\";\n\nexport function pargs() {\n  const pupArgs = process.env[PUP_ARGS_ENV_KEY];\n  if (pupArgs) {\n    const args = [\"exec\", ...process.argv.slice(-1)];\n    args.push(...JSON.parse(pupArgs));\n    logger.debug(\"pupargs\", args);\n    return args;\n  }\n\n  logger.debug(\"procargv\", process.argv);\n  return process.argv;\n}\n\nexport interface ProcessHandle {\n  process: ChildProcess;\n  wait: Promise<void>;\n}\n\nexport function exec(cmd: string, options?: SpawnOptions): ProcessHandle {\n  const parts = cmd.split(\" \").filter((s) => s.length);\n  const [command, ...args] = parts;\n  if (!command) throw new Error(\"empty command\");\n  const proc = spawn(command, args, {\n    stdio: \"inherit\",\n    ...options,\n  });\n  return { process: proc, wait: logger.attach(proc, command) };\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/09.\n\nimport { spawn } from \"child_process\";\nimport type { Size } from \"electron\";\nimport { readFile, rm } from \"fs/promises\";\nimport { join } from \"path\";\nimport { AbortLink, type AbortQuery } from \"./base/abort\";\nimport { pupAppPath } from \"./base/constants\";\nimport { runElectronApp } from \"./base/electron\";\nimport { encodeBgraFile, encodeBgraToMov } from \"./base/encoder\";\nimport { createCoverCommand } from \"./base/ffmpeg\";\nimport { ConcurrencyLimiter } from \"./base/limiter\";\nimport { logger } from \"./base/logging\";\nimport { parseNumber } from \"./base/parser\";\nimport { type ProcessHandle } from \"./base/process\";\nimport type { RecordResult } from \"./base/record\";\nimport { waitAll } from \"./base/stream\";\nimport type { VideoFilesWithCover, VideoSpec } from \"./base/types\";\nimport { DEFAULT_HEIGHT, DEFAULT_WIDTH } from \"./common\";\n\nconst TAG = \"[pup]\";\n\nexport type PupProgressCallback = (progress: number) => Promise<void> | void;\n\nexport interface PupOptions {\n  withAlphaChannel?: boolean;\n  width?: number;\n  height?: number;\n  fps?: number;\n  duration?: number;\n  outDir?: string;\n  cancelQuery?: AbortQuery;\n  onProgress?: PupProgressCallback;\n}\n\nconst PROGRESS_TAG = \" progress: \";\n\nfunction runPupApp(source: string, options: PupOptions) {\n  logger.debug(TAG, `runPupApp`, source, options);\n\n  const args: string[] = [source];\n  if (options.width) args.push(\"--width\", `${options.width}`);\n  if (options.height) args.push(\"--height\", `${options.height}`);\n  if (options.fps) args.push(\"--fps\", `${options.fps}`);\n  if (options.duration) args.push(\"--duration\", `${options.duration}`);\n  if (options.outDir) args.push(\"--out-dir\", options.outDir);\n  if (options.withAlphaChannel) args.push(\"--with-alpha-channel\");\n\n  const w = options.width ?? DEFAULT_WIDTH;\n  const h = options.height ?? DEFAULT_HEIGHT;\n  const handle = runElectronApp({ width: w, height: h }, pupAppPath, args);\n  const counter = new ConcurrencyLimiter(1);\n  handle.process.stdout?.on(\"data\", (data: Buffer) => {\n    let message = data.toString().trim();\n    let start = message.indexOf(PROGRESS_TAG);\n    if (start < 0) {\n      return;\n    }\n    message = message.slice(start + PROGRESS_TAG.length);\n    const end = message.indexOf(\"%\");\n    if (end < 0) {\n      return;\n    }\n    const progressStr = message.slice(0, end);\n    const progress = parseNumber(progressStr);\n    counter.schedule(async () => {\n      await options.onProgress?.(progress);\n    });\n  });\n  return { handle, counter };\n}\n\nexport async function pup(source: string, options: PupOptions) {\n  logger.debug(TAG, `pup`, source, options);\n\n  const link = AbortLink.start(options.cancelQuery);\n  const outDir = options.outDir ?? \"out\";\n\n  const t0 = performance.now();\n  const { handle, counter } = runPupApp(source, { ...options, outDir });\n\n  await link.wait(handle);\n  await counter.end();\n  logger.info(TAG, `capture cost ${Math.round(performance.now() - t0)}ms`);\n\n  const metaPath = join(outDir, \"record.json\");\n  const meta = JSON.parse(await readFile(metaPath, \"utf-8\")) as RecordResult;\n\n  const { bgraPath, written, options: recordOptions } = meta;\n  const { fps, width, height, withAlphaChannel } = recordOptions;\n  const size: Size = { width, height };\n\n  const outputs: VideoFilesWithCover = {\n    mp4: withAlphaChannel ? undefined : join(outDir, \"output.mp4\"),\n    webm: withAlphaChannel ? join(outDir, \"output.webm\") : undefined,\n    mov: withAlphaChannel ? join(outDir, \"output.mov\") : undefined,\n    cover: join(outDir, \"cover.png\"),\n  };\n\n  try {\n    const t1 = performance.now();\n\n    const spec: VideoSpec = { fps, frames: written, size };\n    const handles: ProcessHandle[] = [];\n    if (outputs.mp4) {\n      handles.push(encodeBgraFile(bgraPath, outputs.mp4, spec, \"mp4\"));\n    }\n    if (outputs.webm) {\n      handles.push(encodeBgraFile(bgraPath, outputs.webm, spec, \"webm\"));\n    }\n    if (outputs.mov) {\n      handles.push(encodeBgraToMov(bgraPath, outputs.mov, spec));\n    }\n    await link.wait(...handles);\n\n    const coverSrc = outputs.mov ?? outputs.webm ?? outputs.mp4;\n    if (coverSrc) {\n      const coverCmd = createCoverCommand(coverSrc, outputs.cover);\n      await waitAll(\n        spawn(coverCmd.command, coverCmd.args, { stdio: \"inherit\" }),\n      );\n    }\n\n    link.stop();\n    logger.info(TAG, `encoding cost ${Math.round(performance.now() - t1)}ms`);\n\n    await Promise.all([\n      rm(bgraPath, { force: true }),\n      rm(metaPath, { force: true }),\n    ]);\n    return {\n      ...outputs,\n      width,\n      height,\n      fps,\n      duration: Math.ceil(written / fps),\n    };\n  } catch (error) {\n    await rm(outDir, { recursive: true, force: true });\n    throw error;\n  }\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/11.\n\nimport type { ProcessHandle } from \"./process\";\n\nexport type AsyncTask = () => Promise<void> | void;\nexport type AbortQuery = () => Promise<boolean> | boolean;\n\nexport class AbortLink {\n  private _callback?: AsyncTask;\n  private _aborted?: boolean;\n  private _stopped = false;\n\n  private constructor(\n    readonly query?: AbortQuery,\n    readonly interval: number = 1000,\n  ) {\n    if (query) {\n      this.tick();\n    }\n  }\n\n  static start(query?: AbortQuery, interval?: number) {\n    return new AbortLink(query, interval);\n  }\n\n  get aborted() {\n    return !this._stopped && this._aborted;\n  }\n\n  get stopped() {\n    return this._stopped;\n  }\n\n  async onAbort(callback: AsyncTask) {\n    if (this._aborted) {\n      await callback();\n    } else {\n      this._callback = callback;\n    }\n  }\n\n  wait(...handles: ProcessHandle[]) {\n    const abort = new Promise((_, reject) => {\n      this.onAbort(async () => {\n        handles.forEach((h) => h.process.kill());\n        reject(new Error(\"aborted\"));\n      });\n    });\n    return Promise.race([\n      abort,\n      Promise.all(handles.map((h) => h.wait)), //\n    ]);\n  }\n\n  stop() {\n    this._stopped = true;\n  }\n\n  private tick() {\n    setTimeout(async () => {\n      if (this._stopped) {\n        return;\n      }\n      this._aborted = await this.query?.();\n      if (this._stopped) {\n        return;\n      }\n      if (this._aborted) {\n        await this._callback?.();\n      } else {\n        this.tick();\n      }\n    }, this.interval);\n  }\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/25.\n\nimport electron, { type Size } from \"electron\";\nimport { exec } from \"./process\";\n\nexport const ELECTRON_OPTS = [\n  \"no-sandbox\",\n  \"disable-setuid-sandbox\",\n  \"disable-gpu\",\n  \"disable-dev-shm-usage\",\n  \"disable-software-rasterizer\",\n  \"disable-web-security\",\n  \"disable-site-isolation-trials\",\n  \"disable-features=IsolateOrigins,site-per-process\",\n  \"allow-insecure-localhost\",\n  \"ignore-certificate-errors\",\n  \"disable-blink-features=AutomationControlled\",\n  \"mute-audio\",\n  \"disable-extensions\",\n  \"disable-background-networking\",\n  \"address-family=ipv4\",\n  \"disable-async-dns\",\n  \"force-device-scale-factor=1\",\n  \"trace-warnings\",\n  \"force-color-profile=srgb\",\n  \"disable-color-correct-rendering\",\n  \"log-level=3\",\n];\n\nexport function runElectronApp(size: Size, app: unknown, args: unknown[]) {\n  const electronArgs = ELECTRON_OPTS.map((a) => `--${a}`);\n  const cmdParts = [];\n  if (process.platform === \"linux\") {\n    cmdParts.push(\n      \"xvfb-run\",\n      \"--auto-servernum\",\n      `--server-args='-screen 0 ${size.width}x${size.height}x24'`,\n    );\n  }\n  cmdParts.push(electron, ...electronArgs, app);\n  return exec(cmdParts.join(\" \"), {\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\n    shell: true,\n    env: {\n      ...process.env,\n      ELECTRON_DISABLE_DBUS: \"1\",\n      RUST_BACKTRACE: \"full\",\n      __PUP_ARGS__: JSON.stringify(args),\n    },\n  });\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/09.\n\nimport { existsSync } from \"fs\";\nimport { resolve } from \"path\";\nimport { arch, platform } from \"process\";\nimport { pupFFmpegPath } from \"./constants\";\nimport type { VideoFiles, VideoSpec } from \"./types\";\n\ninterface Command {\n  command: string;\n  args: string[];\n}\n\nconst quiet = [\"-hide_banner\", \"-loglevel\", \"error\", \"-nostats\"];\n\nfunction resolveX265() {\n  const path = `x265/${platform}-${arch}`;\n  const dirs = [\n    resolve(__dirname, `../../${path}`), // process from src\n    resolve(__dirname, `../${path}`), // process from dist\n  ];\n  const found = dirs.find(existsSync);\n  if (!found) {\n    throw new Error(\"x265 not found\");\n  }\n  return found;\n}\n\nexport function createBgraFileCommand(\n  bgraPath: string,\n  spec: VideoSpec,\n  files: VideoFiles,\n): Command {\n  const { fps, frames } = spec;\n  const args = [\n    \"-y\",\n    ...quiet,\n    \"-f\",\n    \"rawvideo\",\n    \"-pix_fmt\",\n    \"bgra\",\n    \"-s\",\n    `${spec.size.width}x${spec.size.height}`,\n    \"-r\",\n    `${fps}`,\n    \"-i\",\n    bgraPath,\n    \"-frames:v\",\n    `${Math.floor(frames)}`,\n  ];\n  if (files.mp4) {\n    args.push(\n      \"-colorspace\",\n      \"bt709\",\n      \"-color_primaries\",\n      \"bt709\",\n      \"-color_trc\",\n      \"bt709\",\n      \"-c:v\",\n      \"libx264\",\n      \"-preset\",\n      \"fast\",\n      \"-threads\",\n      \"0\",\n      \"-pix_fmt\",\n      \"yuv420p\",\n      \"-movflags\",\n      \"+faststart\",\n      files.mp4,\n    );\n  }\n  if (files.webm) {\n    args.push(\n      \"-c:v\",\n      \"libvpx-vp9\",\n      \"-row-mt\",\n      \"1\",\n      \"-cpu-used\",\n      \"1\",\n      \"-threads\",\n      \"0\",\n      \"-pix_fmt\",\n      \"yuva420p\",\n      \"-auto-alt-ref\",\n      \"0\",\n      files.webm,\n    );\n  }\n  return { command: pupFFmpegPath, args };\n}\n\ninterface X265Pipeline {\n  raw: Command;\n  x265: Command;\n  mux: Command;\n}\n\nexport function createBgraToMovPipeline(\n  bgraPath: string,\n  spec: VideoSpec,\n  mov: string,\n): X265Pipeline {\n  const { fps, size } = spec;\n  return {\n    raw: {\n      command: pupFFmpegPath,\n      args: [\n        \"-y\",\n        ...quiet,\n        \"-f\",\n        \"rawvideo\",\n        \"-pix_fmt\",\n        \"bgra\",\n        \"-s\",\n        `${size.width}x${size.height}`,\n        \"-r\",\n        `${fps}`,\n        \"-i\",\n        bgraPath,\n        \"-f\",\n        \"rawvideo\",\n        \"-pix_fmt\",\n        \"yuva420p10le\",\n        \"pipe:1\",\n      ],\n    },\n    x265: {\n      command: resolveX265(),\n      args: [\n        \"--no-progress\",\n        \"--log-level\",\n        \"error\",\n        \"--input\",\n        \"-\",\n        \"--input-res\",\n        `${size.width}x${size.height}`,\n        \"--input-csp\",\n        \"i420\",\n        \"--input-depth\",\n        \"10\",\n        \"--output-depth\",\n        \"10\",\n        \"--fps\",\n        `${fps}`,\n        \"--alpha\",\n        \"--bframes\",\n        \"0\",\n        \"--colorprim\",\n        \"bt709\",\n        \"--transfer\",\n        \"bt709\",\n        \"--colormatrix\",\n        \"bt709\",\n        \"--crf\",\n        \"18\",\n        \"--output\",\n        \"-\",\n      ],\n    },\n    mux: {\n      command: pupFFmpegPath,\n      args: [\n        \"-y\",\n        ...quiet,\n        \"-f\",\n        \"hevc\",\n        \"-r\",\n        `${fps}`,\n        \"-i\",\n        \"pipe:0\",\n        \"-c:v\",\n        \"copy\",\n        \"-tag:v\",\n        \"hvc1\",\n        \"-movflags\",\n        \"+faststart\",\n        mov,\n      ],\n    },\n  };\n}\n\nexport function createCoverCommand(src: string, dst: string): Command {\n  return {\n    command: pupFFmpegPath,\n    args: [\"-y\", ...quiet, \"-i\", src, \"-frames:v\", \"1\", \"-q:v\", \"2\", dst],\n  };\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/09.\n\nimport { createBgraFileCommand, createBgraToMovPipeline } from \"./ffmpeg\";\nimport { exec, type ProcessHandle } from \"./process\";\nimport type { VideoSpec } from \"./types\";\n\nexport function encodeBgraFile(\n  bgraPath: string,\n  outputPath: string,\n  spec: VideoSpec,\n  format: \"mp4\" | \"webm\",\n): ProcessHandle {\n  const files = format === \"mp4\" ? { mp4: outputPath } : { webm: outputPath };\n  const cmd = createBgraFileCommand(bgraPath, spec, files);\n  return exec(`${cmd.command} ${cmd.args.join(\" \")}`, {\n    stdio: [\"ignore\", \"inherit\", \"inherit\"],\n  });\n}\n\nexport function encodeBgraToMov(\n  bgraPath: string,\n  movPath: string,\n  spec: VideoSpec,\n): ProcessHandle {\n  const x265 = createBgraToMovPipeline(bgraPath, spec, movPath);\n  const shellCmd = [\n    `${x265.raw.command} ${x265.raw.args.join(\" \")}`,\n    `${x265.x265.command} ${x265.x265.args.join(\" \")}`,\n    `${x265.mux.command} ${x265.mux.args.join(\" \")}`,\n  ].join(\" | \");\n  return exec(shellCmd, {\n    stdio: [\"ignore\", \"inherit\", \"inherit\"],\n    shell: true,\n  });\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/01/30.\n\nexport class ConcurrencyLimiter {\n  private _active = 0;\n  private _queue: VoidFunction[] = [];\n  private _pending = 0;\n  private _ended = false;\n\n  constructor(readonly maxConcurrency: number) {}\n\n  get active(): number {\n    return this._active;\n  }\n\n  get pending(): number {\n    return this._pending;\n  }\n\n  async schedule<T>(fn: () => Promise<T>): Promise<T> {\n    if (this._ended) {\n      throw new Error(\"ended\");\n    }\n    return new Promise<T>((resolve, reject) => {\n      const run = () => {\n        this._active++;\n        this._pending--;\n        fn()\n          .then(resolve)\n          .catch(reject)\n          .finally(() => {\n            this._active--;\n            this.next();\n          });\n      };\n      this._pending++;\n      if (this._active < this.maxConcurrency) {\n        run();\n      } else {\n        this._queue.push(run);\n      }\n    });\n  }\n\n  async end() {\n    if (!this._ended) {\n      this._ended = true;\n      while (this._active > 0 || this._pending > 0) {\n        await new Promise((resolve) => setTimeout(resolve, 50));\n      }\n    }\n  }\n\n  private next() {\n    if (this._active < this.maxConcurrency && this._queue.length > 0) {\n      this._queue.shift()?.();\n    }\n  }\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/02/09.\n\nimport type { ChildProcess } from \"child_process\";\n\nexport interface StreamWriter {\n  write(buffer: Buffer): Promise<void>;\n  end(): void;\n}\n\nexport function createWriter(stdin: NodeJS.WritableStream): StreamWriter {\n  const drainPromise = new Map<NodeJS.WritableStream, Promise<void>>();\n\n  const waitDrain = (stream: NodeJS.WritableStream) => {\n    const existing = drainPromise.get(stream);\n    if (existing) return existing;\n    const promise = new Promise<void>((resolve, reject) => {\n      const cleanup = (fn: () => void) => {\n        stream.off(\"drain\", onDrain);\n        stream.off(\"error\", onError);\n        stream.off(\"close\", onClose);\n        drainPromise.delete(stream);\n        fn();\n      };\n      const onDrain = () => cleanup(resolve);\n      const onError = (err: Error) => cleanup(() => reject(err));\n      const onClose = () => cleanup(() => reject(new Error(\"stream closed\")));\n      stream.on(\"drain\", onDrain);\n      stream.on(\"error\", onError);\n      stream.on(\"close\", onClose);\n    });\n    drainPromise.set(stream, promise);\n    return promise;\n  };\n\n  const destroyed = () => Reflect.get(stdin, \"destroyed\");\n  return {\n    async write(buffer: Buffer) {\n      if (destroyed()) {\n        throw new Error(\"stdin destroyed\");\n      }\n      if (!stdin.write(buffer)) {\n        await waitDrain(stdin);\n      }\n    },\n    end: () => {\n      if (!destroyed()) stdin.end();\n    },\n  };\n}\n\nexport function pipeline(...procs: ChildProcess[]) {\n  for (let i = 0; i < procs.length - 1; i++) {\n    const src = procs[i];\n    const dst = procs[i + 1];\n    if (!src?.stdout || !dst?.stdin) throw new Error(\"pipeline broken\");\n    src.stdout.pipe(dst.stdin);\n  }\n}\n\nexport function waitAll(...procs: ChildProcess[]) {\n  return Promise.all(\n    procs.map(\n      (proc) =>\n        new Promise<void>((resolve, reject) => {\n          proc.on(\"error\", reject);\n          proc.on(\"close\", (code) =>\n            code === 0\n              ? resolve()\n              : reject(new Error(`exit ${code ?? \"null\"}`)),\n          );\n        }),\n    ),\n  );\n}\n", "// Created by Autokaka (qq1909698494@gmail.com) on 2026/01/30.\n\nimport { makeCLI } from \"./common\";\nimport { pup } from \"./pup\";\n\nmakeCLI(\"pup\", pup);\n"],
  "mappings": ";AAEA,SAAS,eAAe;;;ACAxB,SAAS,kBAAkB;AAC3B,SAAS,eAAe;;;ACOjB,SAAS,KACd,MACA,QACA,cACe;AACf,MAAI;AACF,WAAO,OAAO,QAAQ,IAAI,IAAI,CAAC;AAAA,EACjC,QAAQ;AACN,WAAO;AAAA,EACT;AACF;;;AClBO,SAAS,YAAY,OAAwB;AAClD,MAAI,OAAO,UAAU,UAAU;AAC7B,WAAO;AAAA,EACT;AACA,QAAM,MAAM,OAAO,KAAK;AACxB,MAAI,OAAO,MAAM,GAAG,GAAG;AACrB,UAAM,IAAI,MAAM,SAAS,KAAK,wBAAwB;AAAA,EACxD;AACA,SAAO;AACT;;;AFJA,IAAM,oBAAoB;AAAA,EACxB,QAAQ,WAAW,aAAa;AAAA;AAAA,EAChC,QAAQ,WAAW,SAAS;AAAA;AAAA,EAC5B,QAAQ,WAAW,mBAAmB;AAAA;AACxC;AACO,IAAM,aAAa,kBAAkB,KAAK,UAAU;AAE3D,IAAM,MAAM,QAAQ;AACb,IAAM,cAAc,KAAK,iBAAiB,aAAa,CAAC;AACxD,IAAM,mBAAmB,IAAI,qBAAqB,MAAM;AACxD,IAAM,gBAAgB,IAAI,YAAY,KAAK;;;AGFlD,IAAM,QAAQ;AACd,IAAM,OAAO;AACb,IAAM,OAAO;AACb,IAAM,QAAQ;AACd,IAAM,QAAQ;AAEd,IAAM,SAAN,MAAmC;AAAA,EACzB;AAAA,EAER,IAAI,OAA+B;AACjC,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,KAAK,OAAmB;AAC1B,UAAM,QAAQ,MAAM,SAAS,QAAQ;AACrC,UAAM,OAAO,MAAM,QAAQ,QAAQ;AACnC,UAAM,OAAO,MAAM,QAAQ,QAAQ;AACnC,UAAM,QAAQ,MAAM,SAAS,QAAQ;AACrC,SAAK,QAAQ;AAAA,MACX,OAAO,eAAe,IAAI,QAAQ;AAAA,MAClC,MAAM,eAAe,IAAI,OAAO;AAAA,MAChC,MAAM,eAAe,IAAI,OAAO;AAAA,MAChC,OAAO,eAAe,IAAI,QAAQ;AAAA,IACpC;AAAA,EACF;AAAA,EAEA,cAAc;AACZ,SAAK,OAAO;AAAA,EACd;AAAA,EAEA,SAAS,UAA2B;AAClC,SAAK,MAAM,QAAQ,OAAO,GAAG,QAAQ;AAAA,EACvC;AAAA,EAEA,QAAQ,UAA2B;AACjC,SAAK,MAAM,OAAO,MAAM,GAAG,QAAQ;AAAA,EACrC;AAAA,EAEA,QAAQ,UAA2B;AACjC,SAAK,MAAM,OAAO,MAAM,GAAG,QAAQ;AAAA,EACrC;AAAA,EAEA,SAAS,UAA2B;AAClC,SAAK,MAAM,QAAQ,OAAO,GAAG,QAAQ;AAAA,EACvC;AAAA,EAEA,SAAS,UAA4B;AACnC,SAAK,MAAM,QAAQ,OAAO,GAAG,QAAQ;AACrC,YAAQ,KAAK,CAAC;AAAA,EAChB;AAAA,EAEQ,SAAS,SAAiB;AAChC,QAAI,QAAQ,WAAW,KAAK,GAAG;AAC7B,WAAK,MAAM,QAAQ,MAAM,MAAM,SAAS,CAAC,CAAC;AAAA,IAC5C,WAAW,QAAQ,WAAW,IAAI,GAAG;AACnC,WAAK,KAAK,QAAQ,MAAM,KAAK,SAAS,CAAC,CAAC;AAAA,IAC1C,WAAW,QAAQ,WAAW,IAAI,GAAG;AACnC,WAAK,KAAK,QAAQ,MAAM,KAAK,SAAS,CAAC,CAAC;AAAA,IAC1C,WAAW,QAAQ,WAAW,KAAK,GAAG;AACpC,WAAK,MAAM,QAAQ,MAAM,MAAM,SAAS,CAAC,CAAC;AAAA,IAC5C,OAAO;AACL,WAAK,KAAK,OAAO;AAAA,IACnB;AAAA,EACF;AAAA,EAEA,OAAO,MAAoB,MAAc;AACvC,WAAO,IAAI,QAAc,CAACA,UAAS,WAAW;AAC5C,WAAK,MAAM,GAAG,IAAI,SAAS;AAC3B,UAAI,QAAgB;AACpB,YAAM,WAAW,CAAC,SAAgC;AAChD,cAAM,UAAU,KAAK,SAAS;AAC9B,YAAI,QAAQ,WAAW,KAAK,GAAG;AAC7B,mBAAS,QAAQ,MAAM,MAAM,SAAS,CAAC;AAAA,QACzC,OAAO;AACL,eAAK,SAAS,OAAO;AAAA,QACvB;AAAA,MACF;AACA,WAAK,QAAQ,GAAG,QAAQ,QAAQ;AAChC,WAAK,QAAQ,GAAG,QAAQ,QAAQ;AAChC,WACG,GAAG,WAAW,QAAQ,EACtB,GAAG,SAAS,CAAC,QAAQ;AACpB,iBAAS,IAAI;AACb,aAAK,KAAK;AAAA,MACZ,CAAC,EACA,KAAK,SAAS,CAAC,MAAM,WAAW;AAC/B,YAAI,QAAQ,UAAU,OAAO;AAC3B,oBAAU,mBAAmB,KAAK,UAAU,KAAK,GAAG,CAAC;AACrD,eAAK,MAAM,GAAG,IAAI,UAAU,EAAE,MAAM,QAAQ,MAAM,CAAC;AACnD,iBAAO,IAAI,MAAM,KAAK,CAAC;AAAA,QACzB,OAAO;AACL,eAAK,MAAM,GAAG,IAAI,QAAQ;AAC1B,UAAAA,SAAQ;AAAA,QACV;AAAA,MACF,CAAC,EACA,GAAG,sBAAsB,CAAC,WAAW;AACpC,aAAK,MAAM,GAAG,IAAI,cAAc,MAAM;AAAA,MACxC,CAAC,EACA,GAAG,4BAA4B,CAAC,QAAQ;AACvC,aAAK,MAAM,GAAG,IAAI,cAAc,GAAG;AAAA,MACrC,CAAC;AAAA,IACL,CAAC;AAAA,EACH;AACF;AAEA,IAAM,SAAS,IAAI,OAAO;;;ACtHnB,SAAS,MACd,IACA,cACiD;AACjD,SAAO,IAAI,SAAS;AAClB,QAAI;AACF,YAAM,MAAM,GAAG,GAAG,IAAI;AACtB,UAAI,eAAe,SAAS;AAC1B,eAAO,IAAI,MAAM,MAAM,YAAY;AAAA,MACrC;AACA,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AACF;;;ACfA,SAAS,aAAmD;AAGrD,IAAM,mBAAmB;AAEzB,SAAS,QAAQ;AACtB,QAAM,UAAU,QAAQ,IAAI,gBAAgB;AAC5C,MAAI,SAAS;AACX,UAAM,OAAO,CAAC,QAAQ,GAAG,QAAQ,KAAK,MAAM,EAAE,CAAC;AAC/C,SAAK,KAAK,GAAG,KAAK,MAAM,OAAO,CAAC;AAChC,WAAO,MAAM,WAAW,IAAI;AAC5B,WAAO;AAAA,EACT;AAEA,SAAO,MAAM,YAAY,QAAQ,IAAI;AACrC,SAAO,QAAQ;AACjB;AAOO,SAAS,KAAK,KAAa,SAAuC;AACvE,QAAM,QAAQ,IAAI,MAAM,GAAG,EAAE,OAAO,CAAC,MAAM,EAAE,MAAM;AACnD,QAAM,CAAC,SAAS,GAAG,IAAI,IAAI;AAC3B,MAAI,CAAC,QAAS,OAAM,IAAI,MAAM,eAAe;AAC7C,QAAM,OAAO,MAAM,SAAS,MAAM;AAAA,IAChC,OAAO;AAAA,IACP,GAAG;AAAA,EACL,CAAC;AACD,SAAO,EAAE,SAAS,MAAM,MAAM,OAAO,OAAO,MAAM,OAAO,EAAE;AAC7D;;;ANxBO,IAAM,gBAAgB;AACtB,IAAM,iBAAiB;AACvB,IAAM,cAAc;AACpB,IAAM,mBAAmB;AACzB,IAAM,kBAAkB;AAOxB,SAAS,QAAQ,MAAc,UAAuB;AAC3D,UACG,KAAK,IAAI,EACT,SAAS,YAAY,sBAAiB,EACtC,OAAO,wBAAwB,4BAAQ,GAAG,aAAa,EAAE,EACzD,OAAO,yBAAyB,4BAAQ,GAAG,cAAc,EAAE,EAC3D,OAAO,sBAAsB,gBAAM,GAAG,WAAW,EAAE,EACnD,OAAO,2BAA2B,8CAAW,GAAG,gBAAgB,EAAE,EAClE,OAAO,wBAAwB,4BAAQ,GAAG,eAAe,EAAE,EAC3D,OAAO,4BAA4B,iEAAoB,KAAK,EAC5D;AAAA,IACC;AAAA,IACA;AAAA,IACA;AAAA,EACF,EACC,OAAO,OAAO,QAAgB,SAAS;AACtC,QAAI;AACF,YAAM,SAAS,QAAQ;AAAA,QACrB,OAAO,MAAM,aAAa,aAAa,EAAE,KAAK,KAAK;AAAA,QACnD,QAAQ,MAAM,aAAa,cAAc,EAAE,KAAK,MAAM;AAAA,QACtD,KAAK,MAAM,aAAa,WAAW,EAAE,KAAK,GAAG;AAAA,QAC7C,UAAU,MAAM,aAAa,gBAAgB,EAAE,KAAK,QAAQ;AAAA,QAC5D,QAAQ,KAAK,UAAU;AAAA,QACvB,kBAAkB,KAAK,oBAAoB;AAAA,QAC3C,eAAe,KAAK,iBAAiB;AAAA,MACvC,CAAC;AAAA,IACH,SAAS,GAAG;AACV,aAAO,MAAM,CAAC;AAAA,IAChB;AAAA,EACF,CAAC;AACH,UAAQ,MAAM,MAAM,CAAC;AACvB;;;AOlDA,SAAS,SAAAC,cAAa;AAEtB,SAAS,UAAU,UAAU;AAC7B,SAAS,YAAY;;;ACEd,IAAM,YAAN,MAAM,WAAU;AAAA,EAKb,YACG,OACA,WAAmB,KAC5B;AAFS;AACA;AAET,QAAI,OAAO;AACT,WAAK,KAAK;AAAA,IACZ;AAAA,EACF;AAAA,EAXQ;AAAA,EACA;AAAA,EACA,WAAW;AAAA,EAWnB,OAAO,MAAM,OAAoB,UAAmB;AAClD,WAAO,IAAI,WAAU,OAAO,QAAQ;AAAA,EACtC;AAAA,EAEA,IAAI,UAAU;AACZ,WAAO,CAAC,KAAK,YAAY,KAAK;AAAA,EAChC;AAAA,EAEA,IAAI,UAAU;AACZ,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,MAAM,QAAQ,UAAqB;AACjC,QAAI,KAAK,UAAU;AACjB,YAAM,SAAS;AAAA,IACjB,OAAO;AACL,WAAK,YAAY;AAAA,IACnB;AAAA,EACF;AAAA,EAEA,QAAQ,SAA0B;AAChC,UAAM,QAAQ,IAAI,QAAQ,CAAC,GAAG,WAAW;AACvC,WAAK,QAAQ,YAAY;AACvB,gBAAQ,QAAQ,CAAC,MAAM,EAAE,QAAQ,KAAK,CAAC;AACvC,eAAO,IAAI,MAAM,SAAS,CAAC;AAAA,MAC7B,CAAC;AAAA,IACH,CAAC;AACD,WAAO,QAAQ,KAAK;AAAA,MAClB;AAAA,MACA,QAAQ,IAAI,QAAQ,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC;AAAA;AAAA,IACxC,CAAC;AAAA,EACH;AAAA,EAEA,OAAO;AACL,SAAK,WAAW;AAAA,EAClB;AAAA,EAEQ,OAAO;AACb,eAAW,YAAY;AACrB,UAAI,KAAK,UAAU;AACjB;AAAA,MACF;AACA,WAAK,WAAW,MAAM,KAAK,QAAQ;AACnC,UAAI,KAAK,UAAU;AACjB;AAAA,MACF;AACA,UAAI,KAAK,UAAU;AACjB,cAAM,KAAK,YAAY;AAAA,MACzB,OAAO;AACL,aAAK,KAAK;AAAA,MACZ;AAAA,IACF,GAAG,KAAK,QAAQ;AAAA,EAClB;AACF;;;ACxEA,OAAO,cAA6B;AAG7B,IAAM,gBAAgB;AAAA,EAC3B;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;AAEO,SAAS,eAAe,MAAY,KAAc,MAAiB;AACxE,QAAM,eAAe,cAAc,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;AACtD,QAAM,WAAW,CAAC;AAClB,MAAI,QAAQ,aAAa,SAAS;AAChC,aAAS;AAAA,MACP;AAAA,MACA;AAAA,MACA,4BAA4B,KAAK,KAAK,IAAI,KAAK,MAAM;AAAA,IACvD;AAAA,EACF;AACA,WAAS,KAAK,UAAU,GAAG,cAAc,GAAG;AAC5C,SAAO,KAAK,SAAS,KAAK,GAAG,GAAG;AAAA,IAC9B,OAAO,CAAC,UAAU,QAAQ,MAAM;AAAA,IAChC,OAAO;AAAA,IACP,KAAK;AAAA,MACH,GAAG,QAAQ;AAAA,MACX,uBAAuB;AAAA,MACvB,gBAAgB;AAAA,MAChB,cAAc,KAAK,UAAU,IAAI;AAAA,IACnC;AAAA,EACF,CAAC;AACH;;;AChDA,SAAS,cAAAC,mBAAkB;AAC3B,SAAS,WAAAC,gBAAe;AACxB,SAAS,MAAM,gBAAgB;AAS/B,IAAM,QAAQ,CAAC,gBAAgB,aAAa,SAAS,UAAU;AAE/D,SAAS,cAAc;AACrB,QAAM,OAAO,QAAQ,QAAQ,IAAI,IAAI;AACrC,QAAM,OAAO;AAAA,IACXC,SAAQ,WAAW,SAAS,IAAI,EAAE;AAAA;AAAA,IAClCA,SAAQ,WAAW,MAAM,IAAI,EAAE;AAAA;AAAA,EACjC;AACA,QAAM,QAAQ,KAAK,KAAKC,WAAU;AAClC,MAAI,CAAC,OAAO;AACV,UAAM,IAAI,MAAM,gBAAgB;AAAA,EAClC;AACA,SAAO;AACT;AAEO,SAAS,sBACd,UACA,MACA,OACS;AACT,QAAM,EAAE,KAAK,OAAO,IAAI;AACxB,QAAM,OAAO;AAAA,IACX;AAAA,IACA,GAAG;AAAA,IACH;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAG,KAAK,KAAK,KAAK,IAAI,KAAK,KAAK,MAAM;AAAA,IACtC;AAAA,IACA,GAAG,GAAG;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA,GAAG,KAAK,MAAM,MAAM,CAAC;AAAA,EACvB;AACA,MAAI,MAAM,KAAK;AACb,SAAK;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAM;AAAA,IACR;AAAA,EACF;AACA,MAAI,MAAM,MAAM;AACd,SAAK;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAM;AAAA,IACR;AAAA,EACF;AACA,SAAO,EAAE,SAAS,eAAe,KAAK;AACxC;AAQO,SAAS,wBACd,UACA,MACA,KACc;AACd,QAAM,EAAE,KAAK,KAAK,IAAI;AACtB,SAAO;AAAA,IACL,KAAK;AAAA,MACH,SAAS;AAAA,MACT,MAAM;AAAA,QACJ;AAAA,QACA,GAAG;AAAA,QACH;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,GAAG,KAAK,KAAK,IAAI,KAAK,MAAM;AAAA,QAC5B;AAAA,QACA,GAAG,GAAG;AAAA,QACN;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,IACF;AAAA,IACA,MAAM;AAAA,MACJ,SAAS,YAAY;AAAA,MACrB,MAAM;AAAA,QACJ;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,GAAG,KAAK,KAAK,IAAI,KAAK,MAAM;AAAA,QAC5B;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,GAAG,GAAG;AAAA,QACN;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,IACF;AAAA,IACA,KAAK;AAAA,MACH,SAAS;AAAA,MACT,MAAM;AAAA,QACJ;AAAA,QACA,GAAG;AAAA,QACH;AAAA,QACA;AAAA,QACA;AAAA,QACA,GAAG,GAAG;AAAA,QACN;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;AAEO,SAAS,mBAAmB,KAAa,KAAsB;AACpE,SAAO;AAAA,IACL,SAAS;AAAA,IACT,MAAM,CAAC,MAAM,GAAG,OAAO,MAAM,KAAK,aAAa,KAAK,QAAQ,KAAK,GAAG;AAAA,EACtE;AACF;;;ACrLO,SAAS,eACd,UACA,YACA,MACA,QACe;AACf,QAAM,QAAQ,WAAW,QAAQ,EAAE,KAAK,WAAW,IAAI,EAAE,MAAM,WAAW;AAC1E,QAAM,MAAM,sBAAsB,UAAU,MAAM,KAAK;AACvD,SAAO,KAAK,GAAG,IAAI,OAAO,IAAI,IAAI,KAAK,KAAK,GAAG,CAAC,IAAI;AAAA,IAClD,OAAO,CAAC,UAAU,WAAW,SAAS;AAAA,EACxC,CAAC;AACH;AAEO,SAAS,gBACd,UACA,SACA,MACe;AACf,QAAM,OAAO,wBAAwB,UAAU,MAAM,OAAO;AAC5D,QAAM,WAAW;AAAA,IACf,GAAG,KAAK,IAAI,OAAO,IAAI,KAAK,IAAI,KAAK,KAAK,GAAG,CAAC;AAAA,IAC9C,GAAG,KAAK,KAAK,OAAO,IAAI,KAAK,KAAK,KAAK,KAAK,GAAG,CAAC;AAAA,IAChD,GAAG,KAAK,IAAI,OAAO,IAAI,KAAK,IAAI,KAAK,KAAK,GAAG,CAAC;AAAA,EAChD,EAAE,KAAK,KAAK;AACZ,SAAO,KAAK,UAAU;AAAA,IACpB,OAAO,CAAC,UAAU,WAAW,SAAS;AAAA,IACtC,OAAO;AAAA,EACT,CAAC;AACH;;;AChCO,IAAM,qBAAN,MAAyB;AAAA,EAM9B,YAAqB,gBAAwB;AAAxB;AAAA,EAAyB;AAAA,EALtC,UAAU;AAAA,EACV,SAAyB,CAAC;AAAA,EAC1B,WAAW;AAAA,EACX,SAAS;AAAA,EAIjB,IAAI,SAAiB;AACnB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,IAAI,UAAkB;AACpB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,MAAM,SAAY,IAAkC;AAClD,QAAI,KAAK,QAAQ;AACf,YAAM,IAAI,MAAM,OAAO;AAAA,IACzB;AACA,WAAO,IAAI,QAAW,CAACC,UAAS,WAAW;AACzC,YAAM,MAAM,MAAM;AAChB,aAAK;AACL,aAAK;AACL,WAAG,EACA,KAAKA,QAAO,EACZ,MAAM,MAAM,EACZ,QAAQ,MAAM;AACb,eAAK;AACL,eAAK,KAAK;AAAA,QACZ,CAAC;AAAA,MACL;AACA,WAAK;AACL,UAAI,KAAK,UAAU,KAAK,gBAAgB;AACtC,YAAI;AAAA,MACN,OAAO;AACL,aAAK,OAAO,KAAK,GAAG;AAAA,MACtB;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,MAAM;AACV,QAAI,CAAC,KAAK,QAAQ;AAChB,WAAK,SAAS;AACd,aAAO,KAAK,UAAU,KAAK,KAAK,WAAW,GAAG;AAC5C,cAAM,IAAI,QAAQ,CAACA,aAAY,WAAWA,UAAS,EAAE,CAAC;AAAA,MACxD;AAAA,IACF;AAAA,EACF;AAAA,EAEQ,OAAO;AACb,QAAI,KAAK,UAAU,KAAK,kBAAkB,KAAK,OAAO,SAAS,GAAG;AAChE,WAAK,OAAO,MAAM,IAAI;AAAA,IACxB;AAAA,EACF;AACF;;;ACEO,SAAS,WAAW,OAAuB;AAChD,SAAO,QAAQ;AAAA,IACb,MAAM;AAAA,MACJ,CAAC,SACC,IAAI,QAAc,CAACC,UAAS,WAAW;AACrC,aAAK,GAAG,SAAS,MAAM;AACvB,aAAK;AAAA,UAAG;AAAA,UAAS,CAAC,SAChB,SAAS,IACLA,SAAQ,IACR,OAAO,IAAI,MAAM,QAAQ,QAAQ,MAAM,EAAE,CAAC;AAAA,QAChD;AAAA,MACF,CAAC;AAAA,IACL;AAAA,EACF;AACF;;;ANrDA,IAAM,MAAM;AAeZ,IAAM,eAAe;AAErB,SAAS,UAAU,QAAgB,SAAqB;AACtD,SAAO,MAAM,KAAK,aAAa,QAAQ,OAAO;AAE9C,QAAM,OAAiB,CAAC,MAAM;AAC9B,MAAI,QAAQ,MAAO,MAAK,KAAK,WAAW,GAAG,QAAQ,KAAK,EAAE;AAC1D,MAAI,QAAQ,OAAQ,MAAK,KAAK,YAAY,GAAG,QAAQ,MAAM,EAAE;AAC7D,MAAI,QAAQ,IAAK,MAAK,KAAK,SAAS,GAAG,QAAQ,GAAG,EAAE;AACpD,MAAI,QAAQ,SAAU,MAAK,KAAK,cAAc,GAAG,QAAQ,QAAQ,EAAE;AACnE,MAAI,QAAQ,OAAQ,MAAK,KAAK,aAAa,QAAQ,MAAM;AACzD,MAAI,QAAQ,iBAAkB,MAAK,KAAK,sBAAsB;AAE9D,QAAM,IAAI,QAAQ,SAAS;AAC3B,QAAM,IAAI,QAAQ,UAAU;AAC5B,QAAM,SAAS,eAAe,EAAE,OAAO,GAAG,QAAQ,EAAE,GAAG,YAAY,IAAI;AACvE,QAAM,UAAU,IAAI,mBAAmB,CAAC;AACxC,SAAO,QAAQ,QAAQ,GAAG,QAAQ,CAAC,SAAiB;AAClD,QAAI,UAAU,KAAK,SAAS,EAAE,KAAK;AACnC,QAAI,QAAQ,QAAQ,QAAQ,YAAY;AACxC,QAAI,QAAQ,GAAG;AACb;AAAA,IACF;AACA,cAAU,QAAQ,MAAM,QAAQ,aAAa,MAAM;AACnD,UAAM,MAAM,QAAQ,QAAQ,GAAG;AAC/B,QAAI,MAAM,GAAG;AACX;AAAA,IACF;AACA,UAAM,cAAc,QAAQ,MAAM,GAAG,GAAG;AACxC,UAAM,WAAW,YAAY,WAAW;AACxC,YAAQ,SAAS,YAAY;AAC3B,YAAM,QAAQ,aAAa,QAAQ;AAAA,IACrC,CAAC;AAAA,EACH,CAAC;AACD,SAAO,EAAE,QAAQ,QAAQ;AAC3B;AAEA,eAAsB,IAAI,QAAgB,SAAqB;AAC7D,SAAO,MAAM,KAAK,OAAO,QAAQ,OAAO;AAExC,QAAM,OAAO,UAAU,MAAM,QAAQ,WAAW;AAChD,QAAM,SAAS,QAAQ,UAAU;AAEjC,QAAM,KAAK,YAAY,IAAI;AAC3B,QAAM,EAAE,QAAQ,QAAQ,IAAI,UAAU,QAAQ,EAAE,GAAG,SAAS,OAAO,CAAC;AAEpE,QAAM,KAAK,KAAK,MAAM;AACtB,QAAM,QAAQ,IAAI;AAClB,SAAO,KAAK,KAAK,gBAAgB,KAAK,MAAM,YAAY,IAAI,IAAI,EAAE,CAAC,IAAI;AAEvE,QAAM,WAAW,KAAK,QAAQ,aAAa;AAC3C,QAAM,OAAO,KAAK,MAAM,MAAM,SAAS,UAAU,OAAO,CAAC;AAEzD,QAAM,EAAE,UAAU,SAAS,SAAS,cAAc,IAAI;AACtD,QAAM,EAAE,KAAK,OAAO,QAAQ,iBAAiB,IAAI;AACjD,QAAM,OAAa,EAAE,OAAO,OAAO;AAEnC,QAAM,UAA+B;AAAA,IACnC,KAAK,mBAAmB,SAAY,KAAK,QAAQ,YAAY;AAAA,IAC7D,MAAM,mBAAmB,KAAK,QAAQ,aAAa,IAAI;AAAA,IACvD,KAAK,mBAAmB,KAAK,QAAQ,YAAY,IAAI;AAAA,IACrD,OAAO,KAAK,QAAQ,WAAW;AAAA,EACjC;AAEA,MAAI;AACF,UAAM,KAAK,YAAY,IAAI;AAE3B,UAAM,OAAkB,EAAE,KAAK,QAAQ,SAAS,KAAK;AACrD,UAAM,UAA2B,CAAC;AAClC,QAAI,QAAQ,KAAK;AACf,cAAQ,KAAK,eAAe,UAAU,QAAQ,KAAK,MAAM,KAAK,CAAC;AAAA,IACjE;AACA,QAAI,QAAQ,MAAM;AAChB,cAAQ,KAAK,eAAe,UAAU,QAAQ,MAAM,MAAM,MAAM,CAAC;AAAA,IACnE;AACA,QAAI,QAAQ,KAAK;AACf,cAAQ,KAAK,gBAAgB,UAAU,QAAQ,KAAK,IAAI,CAAC;AAAA,IAC3D;AACA,UAAM,KAAK,KAAK,GAAG,OAAO;AAE1B,UAAM,WAAW,QAAQ,OAAO,QAAQ,QAAQ,QAAQ;AACxD,QAAI,UAAU;AACZ,YAAM,WAAW,mBAAmB,UAAU,QAAQ,KAAK;AAC3D,YAAM;AAAA,QACJC,OAAM,SAAS,SAAS,SAAS,MAAM,EAAE,OAAO,UAAU,CAAC;AAAA,MAC7D;AAAA,IACF;AAEA,SAAK,KAAK;AACV,WAAO,KAAK,KAAK,iBAAiB,KAAK,MAAM,YAAY,IAAI,IAAI,EAAE,CAAC,IAAI;AAExE,UAAM,QAAQ,IAAI;AAAA,MAChB,GAAG,UAAU,EAAE,OAAO,KAAK,CAAC;AAAA,MAC5B,GAAG,UAAU,EAAE,OAAO,KAAK,CAAC;AAAA,IAC9B,CAAC;AACD,WAAO;AAAA,MACL,GAAG;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA,UAAU,KAAK,KAAK,UAAU,GAAG;AAAA,IACnC;AAAA,EACF,SAAS,OAAO;AACd,UAAM,GAAG,QAAQ,EAAE,WAAW,MAAM,OAAO,KAAK,CAAC;AACjD,UAAM;AAAA,EACR;AACF;;;AOxIA,QAAQ,OAAO,GAAG;",
  "names": ["resolve", "spawn", "existsSync", "resolve", "resolve", "existsSync", "resolve", "resolve", "spawn"]
}
